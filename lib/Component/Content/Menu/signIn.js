Object.defineProperty(exports,"__esModule",{value:true});var _toast=require('antd-mobile/lib/toast');var _toast2=_interopRequireDefault(_toast);var _jsxFileName='src/Component/Content/Menu/signIn.js',_this=this;var _templateObject=_taggedTemplateLiteral(['\n    query {\n        allUser {\n            phoneNumber\n        }\n    }\n'],['\n    query {\n        allUser {\n            phoneNumber\n        }\n    }\n']),_templateObject2=_taggedTemplateLiteral(['\n    mutation signIn2server ($phoneNumber: String!, $password: String!) {\n        signIn2server (phoneNumber: $phoneNumber, password: $password) {\n            token\n        }\n    }\n'],['\n    mutation signIn2server ($phoneNumber: String!, $password: String!) {\n        signIn2server (phoneNumber: $phoneNumber, password: $password) {\n            token\n        }\n    }\n']);var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactNative=require('react-native');var _reactRedux=require('react-redux');var _reactImmutableProptypes=require('react-immutable-proptypes');var _reactImmutableProptypes2=_interopRequireDefault(_reactImmutableProptypes);var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);var _graphqlTag=require('graphql-tag');var _graphqlTag2=_interopRequireDefault(_graphqlTag);var _reactApollo=require('react-apollo');var _generateColor=require('../../../Action/generateColor');var _generateColor2=_interopRequireDefault(_generateColor);var _generateSize=require('../../../Action/generateSize');var _generateSize2=_interopRequireDefault(_generateSize);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var query=(0,_graphqlTag2.default)(_templateObject);var signIn2server=(0,_graphqlTag2.default)(_templateObject2);var _Dimensions$get=_reactNative.Dimensions.get('window'),height=_Dimensions$get.height,width=_Dimensions$get.width;var SignIn=function SignIn(_ref){var data=_ref.data,light=_ref.light,fontSize=_ref.fontSize,signInInfo=_ref.signInInfo,signIn=_ref.signIn,signIn2server=_ref.signIn2server,change=_ref.change,registerPress=_ref.registerPress;styles.text=[styles.text,{color:'#'+(0,_generateColor2.default)(166,216,light),fontSize:(0,_generateSize2.default)(fontSize,20),borderBottomColor:'#'+(0,_generateColor2.default)(166,216,light),borderBottomWidth:1}];if(data.loading){return _react2.default.createElement(_reactNative.View,{__source:{fileName:_jsxFileName,lineNumber:44}},_react2.default.createElement(_reactNative.Text,{__source:{fileName:_jsxFileName,lineNumber:44}},'loading...'));}return _react2.default.createElement(_reactNative.TouchableWithoutFeedback,{onPress:_reactNative.Keyboard.dismiss,__source:{fileName:_jsxFileName,lineNumber:47}},_react2.default.createElement(_reactNative.View,{style:[styles.main,{backgroundColor:'#'+(0,_generateColor2.default)(50,109,light)}],__source:{fileName:_jsxFileName,lineNumber:48}},_react2.default.createElement(_reactNative.KeyboardAvoidingView,{behavior:'position',keyboardVerticalOffset:64,__source:{fileName:_jsxFileName,lineNumber:49}},_react2.default.createElement(_reactNative.View,{style:{width:width,alignItems:'center'},__source:{fileName:_jsxFileName,lineNumber:50}},_react2.default.createElement(_reactNative.Image,{style:[styles.logo,{marginTop:height*0.05}],source:require('../../../Image/Logo.png'),__source:{fileName:_jsxFileName,lineNumber:51}}),_react2.default.createElement(_reactNative.TextInput,{placeholder:'\u6CE8\u518C\u624B\u673A\u53F7',placeholderTextColor:'#888',value:signInInfo.get('phoneNumber'),onChangeText:function onChangeText(value){return change({value:value,viewMode:'phoneNumber'});},keyboardType:'numeric',maxLength:11,style:[styles.text,{marginTop:height*0.05}],__source:{fileName:_jsxFileName,lineNumber:52}}),_react2.default.createElement(_reactNative.TextInput,{placeholder:'\u5BC6\u7801',placeholderTextColor:'#888',value:signInInfo.get('password'),onChangeText:function onChangeText(value){return change({value:value,viewMode:'password'});},secureTextEntry:true,style:styles.text,__source:{fileName:_jsxFileName,lineNumber:53}}),_react2.default.createElement(_reactNative.TouchableOpacity,{onPress:signIn({phoneNumber:signInInfo.get('phoneNumber'),password:signInInfo.get('password'),signIn2server:signIn2server}),__source:{fileName:_jsxFileName,lineNumber:54}},_react2.default.createElement(_reactNative.View,{style:styles.button,__source:{fileName:_jsxFileName,lineNumber:55}},_react2.default.createElement(_reactNative.Text,{style:{color:'white',fontSize:20},__source:{fileName:_jsxFileName,lineNumber:56}},'\u767B\u9646'))),_react2.default.createElement(_reactNative.View,{style:{width:0.75*width,flexDirection:'row',justifyContent:'space-between'},__source:{fileName:_jsxFileName,lineNumber:61}},_react2.default.createElement(_reactNative.Text,{onPress:registerPress,style:{textDecorationLine:'underline',fontSize:18,marginTop:10,color:'white'},__source:{fileName:_jsxFileName,lineNumber:62}},'\u6CE8\u518C\u5FAE\u65AF\u4EBA\u8D26\u53F7'),_react2.default.createElement(_reactNative.Text,{onPress:registerPress,style:{textDecorationLine:'underline',fontSize:18,marginTop:10,color:'white'},__source:{fileName:_jsxFileName,lineNumber:63}},'\u5FD8\u8BB0\u5BC6\u7801'))))));};SignIn.propTypes={light:_propTypes2.default.number.isRequired,fontSize:_propTypes2.default.string.isRequired,signInInfo:_reactImmutableProptypes2.default.map.isRequired,change:_propTypes2.default.func.isRequired,registerPress:_propTypes2.default.func.isRequired,signIn:_propTypes2.default.func.isRequired,signIn2server:_propTypes2.default.func.isRequired,data:_propTypes2.default.object.isRequired};var styles=_reactNative.StyleSheet.create({main:{width:width,height:height*0.835,backgroundColor:'#6d6d6d',zIndex:-10,alignItems:'center'},logo:{width:95,height:68},text:{height:45,width:0.75*width,marginTop:15,paddingLeft:20,borderRadius:7,backgroundColor:'transparent'},button:{height:45,width:0.75*width,marginTop:15,backgroundColor:'#a6a6a6',borderRadius:7,alignItems:'center',justifyContent:'center'}});var mapStateToProps=function mapStateToProps(state){return{signInInfo:state.getIn(['menu','signIn']),light:state.getIn(['pageSet','light']),fontSize:state.getIn(['pageSet','fontSize'])};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{change:function change(_ref2){var value=_ref2.value,viewMode=_ref2.viewMode;dispatch({type:'SIGNIN_CHANGE',viewMode:viewMode,value:value});},signIn:function signIn(_ref3){var phoneNumber=_ref3.phoneNumber,password=_ref3.password,signIn2server=_ref3.signIn2server;return function _callee(){var response;return regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return regeneratorRuntime.awrap(signIn2server({variables:{phoneNumber:phoneNumber,password:password}}));case 2:response=_context.sent;if(!response){_context.next=11;break;}_toast2.default.success('登陆成功！');_context.next=7;return regeneratorRuntime.awrap(_reactNative.AsyncStorage.setItem('token',response.data.signIn2server.token));case 7:console.log(response.data.signIn2server);dispatch({type:'ME_SIGNIN',userName:response.data.signIn2server.userName,phoneNumber:response.data.signIn2server.phoneNumber,token:response.data.signIn2server.token,quantum:response.data.signIn2server.quantum,gender:response.data.signIn2server.gender,start:response.data.signIn2server.start});_context.next=12;break;case 11:_toast2.default.fail('登陆失败!');case 12:case'end':return _context.stop();}}},null,_this);};},registerPress:function registerPress(){dispatch({type:'CHANGE_MENU_VIEWMODE',viewMode:'register'});}};};exports.default=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)((0,_reactApollo.compose)((0,_reactApollo.graphql)(query),(0,_reactApollo.graphql)(signIn2server,{name:'signIn2server'}))(SignIn));