Object.defineProperty(exports,"__esModule",{value:true});var _toast=require('antd-mobile/lib/toast');var _toast2=_interopRequireDefault(_toast);var _jsxFileName='src/Component/Content/Menu/register.js',_this=this;var _templateObject=_taggedTemplateLiteral(['\n    query {\n        allUser {\n            userName\n            phoneNumber\n        }\n    }\n'],['\n    query {\n        allUser {\n            userName\n            phoneNumber\n        }\n    }\n']),_templateObject2=_taggedTemplateLiteral(['\n    mutation register2server($userName: String!, $password: String!, $phoneNumber: String!, $gender: String!,  $vertificationCode: String!) {\n        register2server (userName: $userName, password: $password, phoneNumber: $phoneNumber, vertificationCode: $vertificationCode, gender: $gender) {\n            token\n        }\n    }\n'],['\n    mutation register2server($userName: String!, $password: String!, $phoneNumber: String!, $gender: String!,  $vertificationCode: String!) {\n        register2server (userName: $userName, password: $password, phoneNumber: $phoneNumber, vertificationCode: $vertificationCode, gender: $gender) {\n            token\n        }\n    }\n']);var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactNative=require('react-native');var _reactApollo=require('react-apollo');var _graphqlTag=require('graphql-tag');var _graphqlTag2=_interopRequireDefault(_graphqlTag);var _reactRedux=require('react-redux');var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);var _reactImmutableProptypes=require('react-immutable-proptypes');var _reactImmutableProptypes2=_interopRequireDefault(_reactImmutableProptypes);var _reactNativeCheckBox=require('react-native-check-box');var _reactNativeCheckBox2=_interopRequireDefault(_reactNativeCheckBox);var _generateColor=require('../../../Action/generateColor');var _generateColor2=_interopRequireDefault(_generateColor);var _generateSize=require('../../../Action/generateSize');var _generateSize2=_interopRequireDefault(_generateSize);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var query=(0,_graphqlTag2.default)(_templateObject);var register2server=(0,_graphqlTag2.default)(_templateObject2);var _Dimensions$get=_reactNative.Dimensions.get('window'),height=_Dimensions$get.height,width=_Dimensions$get.width;var Register=function Register(_ref){var data=_ref.data,light=_ref.light,fontSize=_ref.fontSize,register=_ref.register,register2server=_ref.register2server,pressProtocolCode=_ref.pressProtocolCode,change=_ref.change,RegisterIt=_ref.RegisterIt,sendVertificationCode=_ref.sendVertificationCode;styles.text=[styles.text,{color:'#'+(0,_generateColor2.default)(166,216,light),fontSize:(0,_generateSize2.default)(fontSize,20),borderBottomColor:'#'+(0,_generateColor2.default)(166,216,light),borderBottomWidth:1}];if(data.loading){return _react2.default.createElement(_reactNative.View,{__source:{fileName:_jsxFileName,lineNumber:49}},_react2.default.createElement(_reactNative.Text,{__source:{fileName:_jsxFileName,lineNumber:49}},'loading... '));}console.log(data);return _react2.default.createElement(_reactNative.TouchableWithoutFeedback,{onPress:_reactNative.Keyboard.dismiss,__source:{fileName:_jsxFileName,lineNumber:53}},_react2.default.createElement(_reactNative.View,{style:[styles.main,{backgroundColor:'#'+(0,_generateColor2.default)(50,109,light)}],__source:{fileName:_jsxFileName,lineNumber:54}},_react2.default.createElement(_reactNative.KeyboardAvoidingView,{behavior:'position',keyboardVerticalOffset:50,__source:{fileName:_jsxFileName,lineNumber:55}},_react2.default.createElement(_reactNative.ScrollView,{__source:{fileName:_jsxFileName,lineNumber:56}},_react2.default.createElement(_reactNative.View,{style:{width:width,alignItems:'center'},__source:{fileName:_jsxFileName,lineNumber:57}},_react2.default.createElement(_reactNative.Image,{style:[styles.logo,{marginTop:height*0.05}],source:require('../../../Image/Logo.png'),__source:{fileName:_jsxFileName,lineNumber:58}}),_react2.default.createElement(_reactNative.TextInput,{placeholder:'\u6635\u79F0',value:register.get('userName'),onChangeText:function onChangeText(value){return change({value:value,viewMode:'userName'});},maxLength:6,placeholderTextColor:'#888',style:[styles.text,{marginTop:height*0.01}],__source:{fileName:_jsxFileName,lineNumber:59}}),_react2.default.createElement(_reactNative.TextInput,{placeholder:'\u624B\u673A\u53F7',value:register.get('phoneNumber'),onChangeText:function onChangeText(value){return change({value:value,viewMode:'phoneNumber'});},placeholderTextColor:'#888',keyboardType:'numeric',maxLength:11,style:styles.text,__source:{fileName:_jsxFileName,lineNumber:60}}),_react2.default.createElement(_reactNative.TextInput,{placeholder:'\u5BC6\u7801',value:register.get('password'),onChangeText:function onChangeText(value){return change({value:value,viewMode:'password'});},style:styles.text,placeholderTextColor:'#888',__source:{fileName:_jsxFileName,lineNumber:61}}),_react2.default.createElement(_reactNative.TextInput,{placeholder:'\u91CD\u590D\u5BC6\u7801',value:register.get('rePassword'),onChangeText:function onChangeText(value){return change({value:value,viewMode:'rePassword'});},style:styles.text,placeholderTextColor:'#888',__source:{fileName:_jsxFileName,lineNumber:62}}),_react2.default.createElement(_reactNative.View,{style:{width:width*0.75,flexDirection:'row',alignItems:'center',justifyContent:'space-between'},__source:{fileName:_jsxFileName,lineNumber:63}},_react2.default.createElement(_reactNative.TextInput,{placeholder:'\u9A8C\u8BC1\u7801',value:register.get('vertificationCode'),maxLength:4,onChangeText:function onChangeText(value){return change({value:value,viewMode:'vertificationCode'});},placeholderTextColor:'#888',style:[styles.text,{width:0.3*width}],__source:{fileName:_jsxFileName,lineNumber:64}}),_react2.default.createElement(_reactNative.View,{style:{marginTop:15,height:45,width:0.45*width,backgroundColor:'transparent',borderBottomColor:'#'+(0,_generateColor2.default)(166,216,light),borderBottomWidth:1,justifyContent:'center',alignItems:'flex-end'},__source:{fileName:_jsxFileName,lineNumber:65}},_react2.default.createElement(_reactNative.Text,{onPress:sendVertificationCode,style:{fontSize:(0,_generateSize2.default)(fontSize,20),color:'#'+(0,_generateColor2.default)(166,216,light)},__source:{fileName:_jsxFileName,lineNumber:66}},'\u53D1\u9001\u9A8C\u8BC1\u7801'))),_react2.default.createElement(_reactNative.View,{style:styles.sex,__source:{fileName:_jsxFileName,lineNumber:71}},_react2.default.createElement(_reactNative.Text,{style:{width:width*0.25,fontSize:18,color:'#ededed',paddingLeft:15},__source:{fileName:_jsxFileName,lineNumber:72}},'\u6027\u522B:'),_react2.default.createElement(_reactNative.View,{style:{width:width*0.5,flexDirection:'row',alignItems:'center',justifyContent:'flex-start'},__source:{fileName:_jsxFileName,lineNumber:75}},_react2.default.createElement(_reactNative.Text,{style:{marginRight:10,fontSize:18,color:'#ededed'},__source:{fileName:_jsxFileName,lineNumber:76}},'\u7537'),_react2.default.createElement(_reactNative.Switch,{value:register.get('gender')==='female',onValueChange:function onValueChange(value){return change({value:value?'female':'male',viewMode:'gender'});},onTintColor:'#aaa',__source:{fileName:_jsxFileName,lineNumber:77}}),_react2.default.createElement(_reactNative.Text,{style:{marginLeft:10,fontSize:18,color:'#ededed'},__source:{fileName:_jsxFileName,lineNumber:78}},'\u5973'))),_react2.default.createElement(_reactNative.View,{style:{width:width*0.75,flexDirection:'row',alignItems:'center',marginTop:5,paddingLeft:15},__source:{fileName:_jsxFileName,lineNumber:81}},_react2.default.createElement(_reactNativeCheckBox2.default,{onClick:function onClick(){return change({value:!register.get('checkbox'),viewMode:'checkbox'});},isChecked:register.get('checkbox'),checkBoxColor:'#ededed',style:{marginRight:10},__source:{fileName:_jsxFileName,lineNumber:82}}),_react2.default.createElement(_reactNative.Text,{style:{fontSize:10,color:'#ccc'},__source:{fileName:_jsxFileName,lineNumber:83}},'\u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F'),_react2.default.createElement(_reactNative.Text,{onPress:pressProtocolCode,style:{fontSize:10,color:'white'},__source:{fileName:_jsxFileName,lineNumber:84}},'\u300A\u5FAE\u65AF\u4EBAAPP\u7528\u6237\u534F\u8BAE\u4E0E\u6CD5\u5F8B\u534F\u8BAE\u300B')),_react2.default.createElement(_reactNative.TouchableOpacity,{onPress:RegisterIt({register:register,userNameList:data.allUser.map(function(value){return value.userName;}),phoneNumberList:data.allUser.map(function(value){return value.phoneNumber;}),register2server:register2server}),__source:{fileName:_jsxFileName,lineNumber:86}},_react2.default.createElement(_reactNative.View,{style:styles.button,__source:{fileName:_jsxFileName,lineNumber:87}},_react2.default.createElement(_reactNative.Text,{style:{color:'white',fontSize:20},__source:{fileName:_jsxFileName,lineNumber:88}},'\u6CE8\u518C\u8D26\u53F7'))))))));};Register.propTypes={data:_propTypes2.default.object.isRequired,light:_propTypes2.default.number.isRequired,fontSize:_propTypes2.default.string.isRequired,register:_reactImmutableProptypes2.default.map.isRequired,pressProtocolCode:_propTypes2.default.func.isRequired,change:_propTypes2.default.func.isRequired,RegisterIt:_propTypes2.default.func.isRequired,sendVertificationCode:_propTypes2.default.func.isRequired};var styles=_reactNative.StyleSheet.create({main:{width:width,height:height*0.835,backgroundColor:'#6d6d6d',zIndex:-10,alignItems:'center'},logo:{width:95,height:68},text:{height:45,width:0.75*width,marginTop:15,paddingLeft:20},sex:{width:width,height:40,marginTop:10,flexDirection:'row',justifyContent:'center',alignItems:'center'},button:{height:50,width:0.75*width,marginTop:20,backgroundColor:'#a6a6a6',borderRadius:7,alignItems:'center',justifyContent:'center'}});var mapStateToProps=function mapStateToProps(state){return{light:state.getIn(['pageSet','light']),fontSize:state.getIn(['pageSet','fontSize']),gender:state.getIn(['menu','register','gender']),register:state.getIn(['menu','register'])};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{pressProtocolCode:function pressProtocolCode(){dispatch({type:'CHANGE_MENU_VIEWMODE',viewMode:'protocol'});},change:function change(_ref2){var value=_ref2.value,viewMode=_ref2.viewMode;dispatch({type:'REGISTER_CHANGE',viewMode:viewMode,value:value});},RegisterIt:function RegisterIt(_ref3){var register=_ref3.register,userNameList=_ref3.userNameList,phoneNumberList=_ref3.phoneNumberList,register2server=_ref3.register2server;return function _callee(){var response;return regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(userNameList,register.get('userName'),phoneNumberList,register.get('password'),register.get('phoneNumber').toString());if(!(!userNameList.includes(register.get('userName'))&&register.get('userName').trim()!==''&&!phoneNumberList.includes(register.get('phoneNumber'))&&register.get('phoneNumber').length===11&&register.get('password')!==''&&register.get('password')===register.get('rePassword')&&register.get('checkbox')&&register.get('vertificationCode').length===4)){_context.next=15;break;}_context.next=4;return regeneratorRuntime.awrap(register2server({variables:{userName:register.get('userName'),password:register.get('password'),phoneNumber:register.get('phoneNumber').toString(),gender:register.get('gender'),vertificationCode:register.get('vertificationCode')}}));case 4:response=_context.sent;if(!response){_context.next=12;break;}_toast2.default.success('注册成功！');_context.next=9;return regeneratorRuntime.awrap(_reactNative.AsyncStorage.setItem('token',response.data.register2server.token));case 9:dispatch({type:'ME_REGISTER',register:register});_context.next=13;break;case 12:_toast2.default.fail('服务器访问错误，请检查您的网络是否畅通！');case 13:_context.next=16;break;case 15:_toast2.default.fail('注册失败！');case 16:case'end':return _context.stop();}}},null,_this);};}};};exports.default=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)((0,_reactApollo.compose)((0,_reactApollo.graphql)(query),(0,_reactApollo.graphql)(register2server,{name:'register2server'}))(Register));