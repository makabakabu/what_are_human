Object.defineProperty(exports,"__esModule",{value:true});var _toast=require('antd-mobile/lib/toast');var _toast2=_interopRequireDefault(_toast);var _jsxFileName='src/Component/Content/OperationPanel/operationPanel.js',_this=this;var _templateObject=_taggedTemplateLiteral(['\n    query academyPieceDetailInfo($order: Int!, $token: String!) {\n        academyPieceDetailInfo(order: $order, token: $token) {\n            text\n            share\n            like\n            likeClick\n            comment\n            revise\n            notes\n        }\n    }\n'],['\n    query academyPieceDetailInfo($order: Int!, $token: String!) {\n        academyPieceDetailInfo(order: $order, token: $token) {\n            text\n            share\n            like\n            likeClick\n            comment\n            revise\n            notes\n        }\n    }\n']),_templateObject2=_taggedTemplateLiteral(['\n    mutation academyLike($token: String!, $order: Int!, $commentId: String!) {\n        academyLike(token: $token, order: $order, commentId: $commentId) {\n            finish\n        }\n    }\n'],['\n    mutation academyLike($token: String!, $order: Int!, $commentId: String!) {\n        academyLike(token: $token, order: $order, commentId: $commentId) {\n            finish\n        }\n    }\n']);var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactNative=require('react-native');var _immutable=require('immutable');var _moment=require('moment');var _moment2=_interopRequireDefault(_moment);var _reactRedux=require('react-redux');var _uuid=require('uuid');var _uuid2=_interopRequireDefault(_uuid);var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);var _graphqlTag=require('graphql-tag');var _graphqlTag2=_interopRequireDefault(_graphqlTag);var _reactApollo=require('react-apollo');var _operationTrigger=require('./operationTrigger');var _operationTrigger2=_interopRequireDefault(_operationTrigger);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var academyPieceDetailInfo=(0,_graphqlTag2.default)(_templateObject);var academyLike=(0,_graphqlTag2.default)(_templateObject2);var _Dimensions$get=_reactNative.Dimensions.get('window'),width=_Dimensions$get.width;var OperationPanel=function OperationPanel(_ref){var token=_ref.token,data=_ref.data,academyLike=_ref.academyLike,likeId=_ref.likeId,imageSource=_ref.imageSource,order=_ref.order,sharePress=_ref.sharePress,commentPress=_ref.commentPress,likePress=_ref.likePress,operationPress=_ref.operationPress;if(data.loading){return _react2.default.createElement(_reactNative.View,{__source:{fileName:_jsxFileName,lineNumber:38}},_react2.default.createElement(_reactNative.Text,{__source:{fileName:_jsxFileName,lineNumber:38}},'loading...'));}return _react2.default.createElement(_reactNative.View,{style:styles.operation,__source:{fileName:_jsxFileName,lineNumber:41}},_react2.default.createElement(_operationTrigger2.default,{imageSource:require('../../../Image/Operation/share.png'),number:data.academyPieceDetailInfo.share.toString(),press:sharePress({sourceDetail:(0,_immutable.Map)({text:'',time:(0,_moment2.default)().format('YYYY-MM-DD hh:mm'),location:(0,_immutable.Map)({order:order})})}),__source:{fileName:_jsxFileName,lineNumber:42}}),_react2.default.createElement(_operationTrigger2.default,{imageSource:require('../../../Image/Operation/comment.png'),number:data.academyPieceDetailInfo.comment.toString(),press:commentPress({location:(0,_immutable.Map)({viewMode:'main',text:'',commentId:(0,_uuid2.default)(),recommentId:''})}),__source:{fileName:_jsxFileName,lineNumber:55}}),_react2.default.createElement(_operationTrigger2.default,{imageSource:imageSource,number:data.academyPieceDetailInfo.like.toString(),likeId:likeId,press:likePress({academyLike:academyLike,order:order,token:token,likeId:likeId}),__source:{fileName:_jsxFileName,lineNumber:67}}),_react2.default.createElement(_operationTrigger2.default,{imageSource:require('../../../Image/Operation/revise.png'),have:data.academyPieceDetailInfo.revise,press:operationPress({viewMode:'revise'}),__source:{fileName:_jsxFileName,lineNumber:78}}),_react2.default.createElement(_operationTrigger2.default,{imageSource:require('../../../Image/Operation/notes.png'),have:data.academyPieceDetailInfo.notes,press:operationPress({viewMode:'notes'}),__source:{fileName:_jsxFileName,lineNumber:83}}));};OperationPanel.propTypes={likeId:_propTypes2.default.string.isRequired,imageSource:_propTypes2.default.number.isRequired,order:_propTypes2.default.number.isRequired,sharePress:_propTypes2.default.func.isRequired,commentPress:_propTypes2.default.func.isRequired,likePress:_propTypes2.default.func.isRequired,operationPress:_propTypes2.default.func.isRequired,data:_propTypes2.default.object.isRequired,token:_propTypes2.default.string.isRequired};var styles=_reactNative.StyleSheet.create({operation:{marginLeft:width*0.025,width:width*0.85,height:40,marginTop:5,flexDirection:'row',justifyContent:'space-between',alignItems:'center'}});var mapStateToProps=function mapStateToProps(state,ownProps){return{likeId:(0,_uuid2.default)(),operation:state.getIn(['academy','content',ownProps.order.toString(),'operation']),imageSource:state.getIn(['academy','content',ownProps.order.toString(),'operation','like','clicked'])?require('../../../Image/Operation/likeAfter.png'):require('../../../Image/Operation/like.png'),text:state.getIn(['academy','content',ownProps.order.toString(),'text']),token:state.getIn(['me','我的信息','token'])};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{sharePress:function sharePress(_ref2){var sourceDetail=_ref2.sourceDetail;return function(){dispatch({type:'OPERATION_2_SHARE',source:'academy',sourceDetail:sourceDetail});dispatch({type:'OPERATION_PRESS',viewMode:'share'});};},operationPress:function operationPress(_ref3){var viewMode=_ref3.viewMode;return function(){return dispatch({type:'OPERATION_PRESS',viewMode:viewMode});};},commentPress:function commentPress(_ref4){var location=_ref4.location;return function(){return dispatch({type:'OPERATION_COMMENT_PRESS',location:location});};},likePress:function likePress(_ref5){var academyLike=_ref5.academyLike,token=_ref5.token,likeId=_ref5.likeId,order=_ref5.order;return function _callee(){var response;return regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this[likeId].swing(800);_context.next=3;return regeneratorRuntime.awrap(academyLike({variables:{token:token,order:order,commentId:''}}));case 3:response=_context.sent;if(response.data.academyLike.finish){_toast2.default.success('点赞成功!');}else{_toast2.default.fail('点赞失败，请检查网络！');}case 5:case'end':return _context.stop();}}},null,_this);};}};};var queryOptions={options:function options(props){return{variables:{order:Number.parseInt(props.order,10),token:''}};}};exports.default=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)((0,_reactApollo.compose)((0,_reactApollo.graphql)(academyPieceDetailInfo,queryOptions),(0,_reactApollo.graphql)(academyLike,{name:'academyLike'}))(OperationPanel));