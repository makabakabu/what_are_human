Object.defineProperty(exports,"__esModule",{value:true});var _immutable=require('immutable');var _moment=require('moment');var _moment2=_interopRequireDefault(_moment);var _uuid=require('uuid');var _uuid2=_interopRequireDefault(_uuid);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var me=function me(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var action=arguments[1];switch(action.type){case'ME_CHANGE_SECTION_VISIBILITY':{state=state.updateIn(['me',action.sectionName,'visibility'],function(value){return!value;});return state;}case'ME_RETURN':if(action.kind==='academy'){state=state.set('viewMode','academy');state=state.setIn(['academy','viewMode'],'section');return state.setIn(['academy','order'],state.getIn(['me',action.viewMode,action.meId,'location','order']));}state=state.set('viewMode','plaza');state=state.setIn(['plaza','plazaName'],action.plazaName);state=state.setIn(['plaza',action.plazaName,'viewMode'],'discuss');return state.setIn(['plaza',action.plazaName,'speechId'],action.speechId);case'ME_ADD':switch(action.viewMode){case'我的评论':{var order=state.getIn(['academy','order']);var comment=state.getIn(['academy','content',order,'operation','comment','content']);var location=(0,_immutable.Map)({});if(comment.last().get('recomment').size>0){location=(0,_immutable.Map)({viewMode:'recomment',order:order,commentId:(0,_immutable.List)(comment.keySeq()).last(),recommentId:(0,_immutable.List)(comment.last().get('recomment').keySeq()).last()});comment=(0,_immutable.Map)({userName:comment.last().get('recomment').last().get('userName'),text:comment.last().get('recomment').last().get('text'),time:(0,_moment2.default)().format('YYYY-MM-DD'),location:location});}else{location=(0,_immutable.Map)({viewMode:'comment',order:order,commentId:(0,_immutable.List)(comment.keySeq()).last(),recommentId:''});comment=(0,_immutable.Map)({userName:comment.last().get('userName'),text:comment.last().get('text'),time:(0,_moment2.default)().format('YYYY-MM-DD'),location:location});}return state.updateIn(['me','我的评论'],function(myComment){return myComment.concat((0,_immutable.OrderedMap)(_defineProperty({},(0,_uuid2.default)(),comment)));});}case'我的点赞':{var _order=state.getIn(['academy','order']);var like=(0,_immutable.Map)({});if(action.location.get('viewMode')==='like'){like=(0,_immutable.Map)({userName:'微斯人',text:'',time:(0,_moment2.default)().format('YYYY-MM-DD'),location:(0,_immutable.Map)({viewMode:'main',order:_order,commentId:''})});}else{var _comment=state.getIn(['academy','content',_order,'operation','comment','content',action.location.get('commentId')]);like=(0,_immutable.Map)({userName:_comment.get('userName'),text:_comment.get('text'),time:(0,_moment2.default)().format('YYYY-MM-DD'),location:(0,_immutable.Map)({viewMode:'comment',order:_order,commentId:action.location.get('commentId')})});}var commentId=state.getIn(['me','我的点赞']).findKey(function(value){return value.get('location').equals(like.get('location'));});if(commentId){return state.deleteIn(['me','我的点赞',commentId]);}return state.updateIn(['me','我的点赞'],function(myLike){return myLike.concat((0,_immutable.OrderedMap)(_defineProperty({},(0,_uuid2.default)(),like)));});}case'我的收藏':case'我的回复':return state.updateIn(['me',action.viewMode],function(collect){return collect.concat((0,_immutable.OrderedMap)(_defineProperty({},(0,_uuid2.default)(),action.sourceDetail)));});case'我的演讲':{var plazaName=state.getIn(['plaza','plazaName']);var speechId=state.getIn(['plaza',plazaName,'speechId']);var speechTitle=state.getIn(['plaza',plazaName,'createSpeech','title']);return state.updateIn(['me','我的演讲'],function(speech){return speech.concat((0,_immutable.OrderedMap)(_defineProperty({},(0,_uuid2.default)(),(0,_immutable.Map)({speechTitle:speechTitle,time:(0,_moment2.default)().format('YYYY-MM-DD hh:mm'),location:(0,_immutable.Map)({plazaName:plazaName,speechId:speechId})}))));});}default:return state;}case'ME_CHANGE_VIEWMODE':return state.setIn(['me','viewMode'],action.viewMode);case'ME_DELETE':return state.deleteIn(['me',action.viewMode,action.id]);case'ME_CHANGE_INFO':return state.setIn(['me','viewMode'],'修改密码');case'ME_LOG_OFF':state=state.setIn(['me','我的信息','gender'],'');state=state.setIn(['me','我的信息','userName'],'');state=state.setIn(['me','我的信息','password'],'');state=state.set('viewMode','menu');state=state.setIn(['menu','backTo'],'me');state=state.setIn(['menu','title'],'登陆');return state.setIn(['menu','viewMode'],'signIn');case'PASSWORD':return state.setIn(['me','修改密码',action.kind],action.text);case'CHANGE_PASSWORD_SUCCESS':if(action.kind==='success'){state=state.setIn(['me','我的信息','password'],state.getIn(['me','修改密码','password']));}state=state.setIn(['me','修改密码','oriPassword'],'');state=state.setIn(['me','修改密码','password'],'');state=state.setIn(['me','修改密码','passwordRepeat'],'');return state;case'ME_REGISTER':{var register=action.register;state=state.set('viewMode','me');state=state.setIn(['me','viewMode'],'我的信息');state=state.setIn(['me','我的信息','gender'],register.get('gender'));state=state.setIn(['me','我的信息','userName'],register.get('name'));state=state.setIn(['me','我的信息','password'],register.get('password'));return state;}case'ME_SIGNIN':state=state.set('viewMode','me');state=state.setIn(['me','viewMode'],'我的信息');state=state.setIn(['me','我的信息','gender'],action.gender);state=state.setIn(['me','我的信息','userName'],action.userName);state=state.setIn(['me','我的信息','token'],action.token);state=state.setIn(['me','我的信息','phoneNumber'],action.phoneNumber);state=state.setIn(['me','我的信息','quantum'],action.quantum);state=state.setIn(['me','我的信息','start'],action.start);return state;default:return state;}};exports.default=me;